# 战斗系统#3

## 前言 本次更新的核心

虽然愿树上的纸条们还在迎风飘扬，但SRD已经有了一个简陋的试玩版本，根据笔者的体验和脑补，总结出以下问题

1. 只要按对防御，就会变得失去挑战性。

方案：敌人行动更复杂、多个敌人同时行动、防御不再是免费行为（现在的防御收益过大 无敌还加能量）

2. 除了防御一直单纯地按攻击就可以了，虽然设定上还有技能的存在，但理论上只是效率问题，而且现在攻击也会加能量

方案：将普通攻击和技能、防御等都统一为【行动】，相当于卡牌游戏中的【卡】，都会耗费能量，耗费手牌（风险是这么改可能会引起复杂度陡增）

3. 现在的操作手感还算可以，但缺乏深度，稍微熟悉便可完全掌握。在操作层面还要再深入的空间！

方案：比之前更像打鼓！

**这次的改动让交互变得空前复杂，之后交互方面的改动不能再做加法**

## 说明

### 基本形态

- 和迭代#1#2的基础类似。玩家控制一个角色，UI提示明显的小节和节拍进度。

- 玩家通过【聚气】获得能量，消耗能量以使用各种【攻击】【防御】技能，击败对手。

- BOSS战的QTE阶段保持不变。

- 仍然没有移动 没有方向键

- 战斗中会不断遇到怪物（冒险背包）

- 各类怪物有各自的独特行动方式，各种行动有固定的抬手动作（抄节奏地牢）

- 每波怪物最多同时出现3个

- 角色的基础属性有血量、灵气、攻击力、防御力

- 节奏搓招卡牌系统，详见下文

- roguelike内容：装备 随机关卡 解锁不同主角机

- 攻击不会被怪打断！双方都为攻击就都费血！鼓励进攻！

- **搓招就是打鼓的感觉！这是鼓手的战斗！**

- **不光是搓招！平砍也是打鼓的感觉！**

### 具体系统说明

#### 战斗系统&名词定义

- 【主角】大家都懂的。

- 【敌人】分为小怪和BOSS。

- 【单位】主角和所有敌人的合成，一些通用情况就是用【单位】称呼。

- 【生命】每个单位都有的基础属性，有生命就算活着，生命小于等于0会判定死亡。生命有上限。

- 【灵气】就是能量，使用各类技能要消耗的资源，有上限

- 【金钱】怪物的主要产出物，用来买东西提升实力

- 【伤害】就是无条件掉血，即减少生命值的过程。

- 【治疗】生命值回升的过程，不会高于生命上限。

- 【攻击】是一方对另一方的攻击行为，包括普攻、技能等等，通常会携带【攻击力】这个数值。

- 【防御】是一种特殊行为，在同一拍上可以完全抵消大部分的【攻击】，除非是直接造成【伤害】的技能。

- 【护甲】是一项表示抗击打能力的属性，由玩家的装备和BUFF决定，怪物的护甲都是0。

- 攻击命中的瞬间，如果被攻击的一方没有进行防御，则受攻击一方受到 [(攻击力-护甲)与1取最大值] 的伤害。

- 以上总的来说是一套很简单的ROGUELIKE系统底子。

#### 节奏输入系统&名词定义

- 【bar】是给玩家的节奏提示UI，现在已改为仿节奏地牢的形式

- 【Note】玩家可以输入的时间点，默认情况下每个4分音符是一个Note，在Bar上以竖线的形式从两边往中间移动，移动到最中间时就说输入的时机。NOTE的排列方式是一种循环，用类似乐谱的形式配置

- 【小节】（暂时未定）

- 【节拍线】，即时没有NOTE的时候，每个4分音符也要有一条线，为了当之后搓招的参考线

- 输入准确度，如果某一Note到达中心的时间点为t,下一拍的时间点为t',假设有判定值a和b：

  - 首先要保证b<=(t'-t)/2,也就是b<=timePerBeat/2,如果不满足则要强行b=timePerBeat/2<br>
  - 然后保证a<=b,如果不满足则要强行a=b<br>
  - 如果在[t-a,t+a]区间内输入按键，则系统判定本次输入为“GOOD”<br>
  - 如果在[t-b,t-a)或(t+a,t+b]之间输入，则为“OK”<br>
  - 如果在[t-b,t'-b]内输入，但没有成功按在“GOOD”或“OK”区域内，则为“BAD”<br>
  - 如果在[t-b,t'-b]之间都没有输入，则为"MISS"

- 出现【BAD】之后，本音符操作无效，一直硬直到下一拍结束

- 【硬直】：保持IDLE状态，且接下来的一次个音符无法输入

- 根据上述规则，定义a为【GOOD区间】区间，定义b为【OK区间】，这两个值决定了输入的难度。

- 【主BAR】和【灵气BAR】
 - 游戏中有两个BAR！没想到吧！
 - 同时显示，分别控制，两个BAR的note和输入判定互不影响
 - 敌人或任何根据节拍行动的东西都会跟随主BAR的NOTE
 - 玩家放技能的决定键都需要按在主BAR的判定上
 - 灵气BAR的NOTE是用来让玩家收集灵气的，具体见下文，同样按错也有硬直。

#### 节奏与战斗融合的部分（大改）


##### 灵气BAR & 集气

- 一般而言，为了考验玩家左右分家的能力，蓄力BAR的NOTE会和主BAR有所不同。

- 灵气BAR上的每一个NOTE都带着灵气，在正确的时机按【集气键(m)】就可收集灵气（播放镲片音效）

- NOTE分为普通NOTE和大NOTE，大NOTE比较稀有，可收集2灵气

##### 主BAR

- 一般而言，主BAR是每个4分音符一个NOTE，也会根据关卡配合BGM有不同的情况（就是加配置，尤其是前期新手阶段，应该很稀疏，一小节顶多一两个）

- 默认情况下，主BAR视为玩家的左手控制区域，对应各类主动行动：就是使用卡牌

##### 节奏卡（技能卡牌）
- 所有单位的所有主动行动都以节奏卡的形式放出（包括怪）

- 节奏卡的属性主要包括【基本类型】【稀有度】【效果】【输入方式】等，以下详解

- 【基本类型】觉得这张卡的基本类型
  - 固定卡:永远固定在手牌中，不会被消耗，可以理解为平A
  - 技能卡:需要抓入手牌，使用后会被扔牌堆底部
  - 怪物卡:怪物用的卡，只有效果，没有其他属性

- 【稀有度】就是普通 稀有 传说这些，直观说明卡牌强度的

- 【输入方式】

  - 技能是玩家按照技能的要求正确输入后发出的招式

  - 发招的前提是： 1.手牌中有这个技能  2.正确输入完成

  - 技能的输入：一个技能必然是若干个【爆气】和一个【攻击】或【防御】按照固定节奏组合而成，【爆气】时播放地鼓音效，【攻击】时播放军鼓音效，【防御】时播放铜鼓音效，如：

   - c      (防御卡
   - z-z-x  (咚咚锵
   - zz-zz-x   (咚咚 咚咚 锵
   - z-zx  (咚~咚锵
   - z--z--x (这是个大切分
  - 相当于把格斗游戏中的“按顺序正确输入”转换成了“按节奏正确输入”，音游手感爆棚，难度区间也容易做的很大，甚至还可以实现3连音的技能。

  - 输入方式的显示以类似音游谱子的形式（大合奏），以四分音符线作为辅助，当玩家正确输入时，谱子的相应音符会点亮，正确释放后要有炫酷的特效。

 - **总结：从【攻击】算起，往前追溯本小段内所有连续的【蓄力】，和当前手牌中的卡对比，取符合的最长的一个技能放出。**

- 卡牌的循环

 - 固定卡一直在手中（还没想好是一张还是两张，防御要不要常驻手中）

 - 技能卡按照顺序进入手牌，直至填满所有空位

 - 在战斗间隙可以配置手牌的顺序（方便背谱和COMBO）

 - 玩家打出技能牌后，该牌放到牌库底部，如果手牌不满则到手牌中

 - 玩家有机会删卡！（杀戮尖塔的精髓）

- 卡牌的效果（同时可能有多个效果）

 - 高攻的攻击

 - 防御

 - 加灵气

 - 增加BUFF/debuff
   - 加攻击力
   - 加护甲
   - 加各种属性上限
   - 。。。。

 - 给敌人增加BUFF/debuff

 - 加血

 - AOE

 - 其他特殊效果，能咋拓展就咋拓展




#### 敌人

- 敌人在玩家游戏的过程中会不断出现，敌人的种类和出现的时机由关卡决定

- 敌人入场后都有固定的行动方式，固定的属性，固定的前摇后摇

- 【入场】||【等待】 【前摇】 【攻击】 【后摇】 :||

- 受到攻击变为 【硬直】

- 五种状态都是持续固定N个8分音符 举例：

  - 入入|前攻后等 前攻后等|前攻后等 前攻后等…………
  - |入入入入前前攻后|等等等等前前攻后|等等等等前前攻后…………

- 血量低于XX后可能变更攻击方式或行动

- 敌人的攻击有瞬间发生伤害，也有带延迟的，各几拍才发生伤害

- 敌人受到玩家攻击，血量没了就死亡

- 怪死了会爆钱，玩家直接获得

#### 魂
- 【魂】相当于音游中的连击槽，最低为0，满格为8，超过8升一级，共3级
  - 每次“GOOD”增加2
  - 每次“OK”增加1
  - 每次“BAD”减少1级
  - 2级魂时打怪获得2倍的金币，3级魂时通过打怪获得4倍金币
  - 某些道具、技能的效果 也和魂等级相关
