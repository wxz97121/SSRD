# 战斗系统#2

## 前言 温故而知新

在SRD初期阶段，经过群员热烈的讨论和冷静分析，着实无法看到原有设计的前途，固进行迭代，希望能够进化出可行又好玩的战斗方式。

之所以抛弃原始版本，原因有三

1. 最脑残的原因：无法想到一个同时结算同时演出的好玩的游戏

2. 运气成分太重，所谓的决策仅是剔除错误选项后的石头剪刀布

3. 比较类似就是口袋妖怪的战斗，但前提是有更上一级的非常完备的体系，这个体系是海量的角色和技能堆积出的化学反应，如果强行和节奏融合难度太大了。

## 说明

#### 概述

根据之前的结论，有”强数值“和“强动作”两条路，那么很明显，”动作+“节奏”更爽！如果《节奏地牢》和《PATAPON》是节奏战斗游戏的两个流派，SRD已经从中间点偏向《节奏地牢》，成为了节奏战斗类游戏的“左派”！

#### 基本形态

- 和迭代#1的基础类似。玩家控制一个角色，UI提示明显的小节和节拍进度。

- 玩家通过【蓄力】【攻击】【防御】三个键按节奏输入打出技能，击败对手。

- 不同的是并不是到一小节中的某一拍终止输入，也没有固定的禁操作看演出时段。

- BOSS战的QTE阶段保持不变。

- 仍然没有移动 没有方向键

- 战斗中会不断遇到怪物（冒险背包）

- 各类怪物有非常固定的行动方式【节奏型】（抄节奏地牢）

- 最多会有2到3个怪物同时和玩家进行战斗

- 仍然有节拍提示线，但输入不用有标志留在上面

- 角色的基础属性有血量、灵气、攻击力、防御力，但灵气不再由指令获得

- 角色可以配备技能

>有若干个（拍脑袋3个）技能槽，可通过拾取、购买获得技能,技能需要靠搓招释放

- 角色有装备

>提供被动技能和属性,可通过拾取、购买获得技能

- 有浓厚的roguelike味

- **搓招就是打鼓的感觉！这是鼓手的战斗！**

#### 具体系统说明

##### 战斗系统&名词定义

- 【主角】大家都懂的。

- 【敌人】分为小怪和BOSS。

- 【单位】主角和所有敌人的合成，一些通用情况就是用【单位】称呼。

- 【生命】每个单位都有的基础属性，有生命就算活着，生命小于等于0会判定死亡。生命有上限。

- 【伤害】就是无条件掉血，即减少生命值的过程。

- 【治疗】生命值回升的过程，不会高于生命上限。

- 【攻击】是一方对另一方的攻击行为，包括普攻、技能等等，通常会携带【攻击力】这个数值。

- 【防御】是一种特殊行为，在同一拍上可以完全抵消大部分的【攻击】，除非是直接造成【伤害】的技能。

- 【护甲】是一项表示抗击打能力的属性，由玩家的装备和BUFF决定，怪物的护甲都是0。

- 攻击命中的瞬间，如果被攻击的一方没有进行防御，则受攻击一方受到 [(攻击力-护甲)与1取最大值] 的伤害。

- 以上总的来说是一套很简单的ROGUELIKE系统底子。

##### 节奏输入系统&名词定义

- 在BPM120上下4/4拍的固定节拍中，节拍提示UI会显示8条线 4大4小 代表8个4分音符，正拍和反拍

 |正-反-正-反|正-反-正-反|<br>  
( 动 次 打 次 动 次 打 次)

以上结构算作一个完整的【小段】，每一个4分音符称为一个【拍】<br>
//其实这是2小节，之前貌似算错了，60速度才是1小节

- 输入准确度，如果某一拍的时间点为t,下一拍的时间点为t',假设有判定值a和b：

 - 首先要保证b<=(t'-t)/2,也就是b<=timePerBeat/2,如果不满足则要强行b=timePerBeat/2<br>
 - 然后保证a<=b,如果不满足则要强行a=b<br>
 - 如果在[t-a,t+a]区间内输入按键，则系统判定本次输入为“GOOD”<br>
 - 如果在[t-b,t-a)或(t+a,t+b]之间输入，则为“OK”<br>
 - 如果在[t-b,t'-b]内输入，但没有成功按在“GOOD”或“OK”区域内，则为“BAD”<br>
 - 如果在[t-b,t'-b]之间都没有输入，则为"MISS"

- 出现【BAD】之后，本拍操作无效，一直硬直到下一拍结束

- 【硬直】：保持IDLE状态，且无法输入

- 根据上述规则，定义a为【GOOD区间】区间，定义b为【OK区间】，这两个值决定了输入的难度。

- 【空拍】在某些关卡或怪物技能的影响下，小段中一些节拍会变为【空拍】，UI会特殊显示，示意玩家不要在此时输入
 - 如果输入则会被判定为“BAD”
 - 敌人或任何根据节拍行动的东西（定时攻击等等）在空拍时都会暂停行动

##### 节奏与战斗融合的部分

- 玩家可以在任何4分音符上输入【攻击】，输入正确后立刻产生效果进行普攻

- 玩家可以在任何4分音符上输入【防御】，用来防御敌人的攻击。

- 玩家可以在任意时候输入【蓄力】（为了实现复杂节奏），有一个用户难以感知的内置CD。判定蓄力输入的准确度在下文中给出。

- 【加强拍】在一个小段内，会有若干个加强拍，在此输入攻击后进行的普攻或技能都有攻击加成
 - 一般设定在第3和第7拍

- 【灵气】主角发动技能所需的资源
 - 从0开始积累
 - 有上限 默认为5
 - 当一次输入评价为“GOOD”时增长1灵气
 - 当一次输入评价为“OK”是增长0.5灵气
 - 当一次输入评价为“MISS”或“BAD”时灵气无变化
 - 如果一次输入同时消耗灵气和获得灵气，先进行消耗的计算，后进行获得计算。

- 【魂】相当于音游中的连击槽，最低为0，满格为8
 - 每次“GOOD”增加2
 - 每次“OK”增加1
 - 每次“MISS”减少2
 - 每次“BAD”减少4
 - 魂>=4时打怪获得2倍的金币，魂=8时通过打怪获得4倍金币
 - 某些道具、技能的效果 也和魂度相关

##### 技能

- 技能是玩家按照技能的要求正确输入后发出的招式

- 发招的前提是： 1.必须装备了这个技能  2.正确输入完成 3.支付相应的资源

- 技能的输入：一个技能必然是若干个【蓄力】和一个【攻击】按照固定节奏组合而成，【蓄力】时播放地鼓音效，【攻击】时播放军鼓音效，如：

> ”x“=蓄力 【c】=攻击 【—】=休止符 一个字符代表一个8分音符的长度

x-x-c  (咚咚锵<br>
xx-xx-c   (咚咚 咚咚 锵<br>
x-xc  (咚~咚锵<br>
x--x--c (这是个大切分<br>

- 相当于把格斗游戏中的“按顺序正确输入”转换成了“按节奏正确输入”，音游手感爆棚，难度区间也容易做的很大，甚至还可以实现3连音的技能。

- 技能必须在一个小段内完成，不能跨小段输入。输入之间插入【防】的话也不算。

- **总结：从【攻击】算起，往前追溯本小段内所有连续的【蓄力】，和当前装备的技能对比，取符合的最长的一个技能放出。**

##### 技能的效果

- 这个就是ROGUELIKE的点了，但基本上还是改变一些攻击属性。

- 举例：

>高攻击力

>增加BUFF

>给敌人增加DEBUFF

>加血

>AOE

##### 敌人

- 敌人在玩家游戏的过程中会不断出现，敌人的种类和出现的时机由关卡决定

- 敌人入场后都有固定的行动方式，固定的属性，固定的前摇后摇

- 【入场】||【等待】 【前摇】 【攻击】 【后摇】 :||

- 受到攻击变为 【硬直】

- 五种状态都是持续固定N个8分音符 举例：

>入入|前攻后等 前攻后等|前攻后等 前攻后等…………
>|入入入入前前攻后|等等等等前前攻后|等等等等前前攻后…………

- 血量低于XX后可能变更攻击方式或行动

- 敌人的攻击有瞬间发生伤害，也有带延迟的，各几拍才发生伤害

- 敌人受到玩家攻击，血量没了就死亡

- 怪死了会爆钱，玩家直接获得
